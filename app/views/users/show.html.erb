<div class="container">
  <% provide(:title, @user.name) %>
  <div class="row">
    <div class="col-sm-2">
      <div class="plaza_stats">
        <div>
          <div class="background_img"></div>
          <ul class="plaza_name_img">
            <li>
              <ul>
                <li>
                  <div class="plaza_img">
                    <%= image_tag @user.foto.url, class: "img-circle", size: 100  if @user.foto? %> 
                  </div>
                </li>
                <li class="texto">
                  <ul style="list-style: none; padding: 0px;">
                    <li>
                      <div class="plaza_name">
                        <%= @user.name %>
                      </div>
                    </li>
                    <% if @user.description? %>
                    <li class="description">
                      <%= @user.description %>
                    </li>
                    <% end %>                
                  </ul>
                </li>                  
              </ul>
            </li>
            <li style="padding-top: 20px;">
              <%= render 'follow_form' if logged_in? %>
            </li>
          </ul>
        </div>
      </div>

      <div class="aside_content">
        <ul class="inline" style="margin-bottom: 0px;">
          <li class="titulo">
            Perfil de linkedIN
          </li>
          <li class="lista_block" style="position: absolute; right: 20px;">
            <%= link_to image_tag("linkedinlogo.png", size: 25), "#{@user.linkedin}" if @user.linkedin? %> 
          </li>
        </ul>
      </div>

      <div class="aside_content">
        <ul class="principal">
          <li class="titulo">
            Comunidad
          </li>
          <li class="lista_block">
            <ul class="inline">
              <li>
                <i class="fa fa-user-o" aria-hidden="true"></i>   Seguidores
              </li>
              <li class="right">
                <a href="<%= followers_user_path(@user) %>">
                  <%= @user.followers.count %>
                </a>
              </li>
            </ul>
          </li>
          <li class="lista_block">
            <ul class="inline">
              <li>
                <i class="fa fa-user-o" aria-hidden="true"></i>   Seguidos
              </li>
              <li class="right">
                <a href="<%= following_user_path(@user) %>">
                  <%= @user.following.count %>
                </a>
              </li>
            </ul>
          </li>
          <li class="lista_block">
            <ul class="inline">
              <li>
                <i class="fa fa-envelope-open-o" aria-hidden="true"></i>   Iniciativas
              </li>
              <li class="right">
                <%= @microposts.where(:petition => true).count %>
              </li>
            </ul>
          </li>
          <li class="lista_block">
            <ul class="inline">
              <li>
                <i class="fa fa-hand-o-up" aria-hidden="true"></i>   Votos totales
              </li>
              <li class="right">
                <%= Vote.where(:micropost_id => @microposts).count %>
              </li>
            </ul>
          </li>
          <li class="lista_block">
            <ul class="inline">
              <li>
                <i class="fa fa-circle-o" aria-hidden="true"></i>   Círculos con los que colabora
              </li>
              <li class="right">
                <%= @plazas_grupos.count %>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>

    <div class="col-sm-4" style="margin-top: 12px;">
      <div class="aside_content">
        <ul class="principal">
          <li class="titulo">
            <h3 style="font-size: 16px; margin: 0px;"><b>Temas que interesan al usuario</b></h3>
          </li>
          <li class="lista_block">
            <ul class="inline">
              <li>
                <% @microposts.take(3).each do |post| %>
                  <% if post.hashtag1.empty? %>
                  <% else %>
                    <i class="fa fa-hashtag fa-lg" aria-hidden="true"></i>
                    <b><%= link_to post.hashtag1, {:controller => "microposts", action: "hashtag", :id => post.id}  %></b>
                  <% end %>  
                <% end %>
              </li>
            </ul>
          </li>
        </ul>
      </div>

      <div class="aside_content">
        <ul class="principal">
          <li class="titulo">
            <h3 style="font-size: 16px; margin: 0px;"><b><i class="fa fa-file-text-o" aria-hidden="true"></i>&nbsp;Consultas ciudadanas creadas</b></h3>
          </li>
          <% @peticiones.first(5).each do |petition| %>
          <li class="lista_block">
            <ul class="inline">
              <li class="inline">
                <%= image_tag petition.picture.url, size: 50 if petition.picture? %>
              </li>
              <li class="inline">
                <span class="nombres"><%= link_to petition.title, micropost_path(id: petition) %></b></span>
              </li>
              <li class="right" style="padding-top: 10px;">
                <% @votos = Vote.where(:micropost_id => petition) %>
                <% @votos_realizados = @votos.count %>
                <% if @votos_realizados != 0 %>
                <% @votos_positivos = @votos.where(:like => true).count %>
                <i class="fa fa-thumbs-o-up" aria-hidden="true"></i> <%= @votos_positivos*100/(@votos_realizados) %> %
                <% else %>
                  0 %
                <% end %>
              </li>
            </ul>
            <% end %>
          </li>
        </ul>
      </div>

      <div class="aside_content">
        <ul class="principal">
          <li class="titulo">
            <h3 style="font-size: 16px; margin: 0px;"><b><i class="fa fa-file-text-o" aria-hidden="true"></i>&nbsp;Iniciativas apoyadas por <%= @user.name %></b></h3>
          </li>
          <% @votos = Vote.where(:user_id => @user.id).where(like: 1) %>
          <% @votos.first(10).each do |voto| %>
            <% @peticiones_votadas = @peticiones_all.where(id: voto.micropost_id) %>
            <% @peticiones_votadas.first(5).each do |petition| %>
              <li class="lista_block">
                <ul class="inline">
                  <li class="inline">
                    <%= image_tag petition.picture.url, size: 50 if petition.picture? %>
                  </li>
                  <li class="inline">
                    <span class="nombres"><%= link_to petition.title, micropost_path(id: petition) %></b></span>
                  </li>
                  <li class="right" style="padding-top: 10px;">
                  </li>
                </ul>
              </li>
            <% end %>
          <% end %>
        </ul>
      </div>

      <div class="aside_content">
        <ul class="principal">
          <li class="titulo">
            <h3 style="font-size: 16px; margin: 0px;"><b><i class="fa fa-file-text-o" aria-hidden="true"></i>&nbsp;Iniciativas rechazadas por <%= @user.name %></b></h3>
          </li>
          <% @votos = Vote.where(:user_id => @user.id).where(dislike: 1) %>
          <% @votos.first(10).each do |voto| %>
            <% @peticiones_votadas = @peticiones_all.where(id: voto.micropost_id) %>
            <% @peticiones_votadas.first(5).each do |petition| %>
              <li class="lista_block">
                <ul class="inline">
                  <li class="inline">
                    <%= image_tag petition.picture.url, size: 50 if petition.picture? %>
                  </li>
                  <li class="inline">
                    <span class="nombres"><%= link_to petition.title, micropost_path(id: petition) %></b></span>
                  </li>
                  <li class="right" style="padding-top: 10px;">
                  </li>
                </ul>
              </li>
            <% end %>
          <% end %>
        </ul>
      </div>

      <div class="aside_content">
        <ul class="principal" >
          <li class="titulo">
            <ul style="padding: 0px; display: inline-flex;">
              <li style="width: 80%; border: 0px; display: inline-flex;">
                <i class="fa fa-circle-o fa-lg" aria-hidden="true"></i>
            &nbsp;<h3 style="font-size: 16px; margin: 0px;"><b>Círculos en los que participa <%= @user.name %></b></h3>
              </li>
              <li style="position: absolute; right: 30px; border: 0px;">
                <span style=""><%= link_to "Ver todos", user_plazas_path(user_id: @user) %></span>
              </li>
            </ul>
          </li>
          <% @plazas_grupos.first(5).each do |grupo| %>
            <% @plaza_seguida = Plaza.where(:id => grupo.plaza_id) %>
            <% @plaza_seguida.each do |plaza| %>
              <% if plaza.action != true %>
                <li class="lista_block">
                  <ul class="inline">
                    <li class="inline">
                      <%= image_tag plaza.foto.url, class: "img-circle", size: 55 if plaza.foto? %>
                    </li>
                    <li class="inline">
                      <span class="nombres" style="width: 100%;"><%= link_to plaza.name, user_plaza_path(id: plaza.id, user_id: current_user.id) %></b></span>
                    </li>
                  </ul>
                </li>
              <% end %>
            <% end %>
          <% end %>
        </ul>
      </div>

      <%= render 'plazas/action_short' %>

      <%= render 'plazas/causa_short' %>

    </div>

    <div class="col-sm-6" style="margin-top: 15px;">
      <% if @microposts.any? %>
        <h3 style="font-size: 16px; margin: 0px;"><b>Posts(<%= @microposts.count %>)</b></h3>
        <ol class="microposts" style="padding-top: 10px;">
          <%= render @microposts %>
        </ol>
        <%= will_paginate @microposts %>
      <% else %>
        El usuario <%= @user.name %> no tiene publicaciones, pero te mostramos algunos usuarios que podrían interesarte. 
      <% end %>
    </div>

  </div>
</div>